<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <title>Autenticaci√≥ BIM IFC a Blockchain</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <style>
    body {
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      margin: 0; padding: 0;
      background: #f6f8fa;
      color: #232b38;
    }
    header {
      background: linear-gradient(90deg, #124c8d 0%, #3496e2 100%);
      color: #fff;
      padding: 2.4rem 0 2rem 0;
      text-align: center;
      box-shadow: 0 3px 12px rgba(27,77,145,0.07);
      position: relative;
    }
    .logo-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 1.2rem;
      gap: 1.3em;
    }
    .logo-svg {
      width: 56px; height: 56px;
      background: #fff; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      border: 2.5px solid #3496e2;
      box-shadow: 0 4px 22px #124c8d23;
    }
    .logo-title {
      font-weight: 700;
      font-size: 2.1rem;
      color: #fff;
      letter-spacing: 0.03em;
      margin-left: 0.1em;
      text-shadow: 0 2px 10px #19518635;
    }
    #lang-selector {
      position: absolute;
      top: 24px; right: 30px;
      padding: 0.32em 1.2em;
      border-radius: 6px;
      background: #fff;
      color: #124c8d;
      border: none;
      font-size: 1em;
      box-shadow: 0 2px 10px #124c8d19;
      font-weight: 500;
      cursor: pointer;
    }
    main {
      max-width: 880px;
      margin: 2.5rem auto 2rem auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 22px rgba(27,77,145,0.11);
      padding: 2.6rem 2rem 2.5rem 2rem;
    }
    h2 {
      color: #195186;
      margin-top: 1.5em;
      margin-bottom: 0.9em;
      font-size: 1.32rem;
      letter-spacing: 0.01em;
    }
    ul, ol {
      margin-left: 1.3em;
    }
    .cta {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 2.7em 0 1.7em 0;
      padding: 2em 0 1.5em 0;
      border-top: 1px solid #e4eaf2;
      border-bottom: 1px solid #e4eaf2;
      background: #f4f8fc;
      border-radius: 10px;
    }
    .cta a {
      font-size: 1.15em;
      color: #fff;
      background: #195186;
      padding: 0.85em 2.1em;
      border-radius: 6px;
      text-decoration: none;
      box-shadow: 0 2px 10px #19518618;
      margin-top: 0.6em;
      transition: background 0.15s;
      font-weight: 500;
    }
    .cta a:hover {
      background: #2379ca;
    }
    .faq {
      margin-top: 2.5em;
      margin-bottom: 1em;
    }
    .faq h2 {
      margin-bottom: 0.7em;
    }
    .faq-item {
      margin-bottom: 1.3em;
      padding: 1em 1.2em 0.5em 1.2em;
      border-radius: 8px;
      background: #f7fbfe;
      box-shadow: 0 1px 8px #3496e211;
    }
    .faq-q {
      font-weight: 600;
      color: #165294;
      margin-bottom: 0.22em;
    }
    .faq-a {
      color: #234;
      margin-left: 0.18em;
    }
    footer {
      text-align: center;
      font-size: 1em;
      color: #888;
      padding: 2.5em 0 1em 0;
    }
    @media (max-width: 600px) {
      main { padding: 1.1rem 0.3rem 1.2rem 0.3rem; }
      header { padding: 1.2rem 0 1.1rem 0; }
      #lang-selector { top: 16px; right: 8px; }
      .logo-title { font-size: 1.3rem; }
    }
    nav { display: flex; justify-content: center; align-items: center; background: #f5faff; border-bottom: 1.5px solid #e6ecf6; gap: 0.8em; padding: 0.6em 0 0.3em 0; font-size: 1.09em; position: relative; z-index: 2; }
    nav a { color: #195186; text-decoration: none; padding: 0.46em 1.16em; border-radius: 7px; font-weight: 500; transition: background 0.14s, color 0.14s; letter-spacing: 0.02em; }
    nav a:hover, nav a.active { background: #d7ebfc; color: #124c8d; }

    /* Timeline steps (pots posar-ho al final del teu <style>!) */
.timeline-section {
  margin: 2.5em 0 2em 0;
  padding: 0 0.5em;
}
.timeline {
  display: flex;
  flex-wrap: wrap;
  gap: 1.6em;
  justify-content: space-between;
  align-items: flex-start;
  margin: 0 auto;
  max-width: 760px;
  position: relative;
}
.timeline-step {
  background: #f4faff;
  border-radius: 18px;
  padding: 1.4em 1.1em 1.1em 1.1em;
  box-shadow: 0 3px 18px #124c8d13;
  min-width: 140px;
  flex: 1 1 170px;
  text-align: center;
  position: relative;
  transition: transform 0.2s, box-shadow 0.2s;
  cursor: pointer;
}
.timeline-step:hover {
  transform: translateY(-6px) scale(1.035);
  box-shadow: 0 8px 32px #124c8d24;
  background: #e0f3fa;
}
.timeline-step .step-number {
  display: inline-block;
  background: linear-gradient(90deg, #124c8d 60%, #27e8c5 100%);
  color: #fff;
  font-size: 1.25em;
  width: 2.2em;
  height: 2.2em;
  border-radius: 50%;
  line-height: 2.2em;
  font-weight: 700;
  margin-bottom: 0.7em;
  box-shadow: 0 2px 8px #19518617;
}
.timeline-step .step-icon {
  font-size: 2.3em;
  margin-bottom: 0.35em;
  color: #124c8d;
  display: block;
}
.timeline-connector {
  width: 36px;
  height: 4px;
  background: linear-gradient(90deg, #27e8c5 0%, #124c8d 100%);
  border-radius: 3px;
  position: absolute;
  left: 50%; top: 37px;
  z-index: 0;
  transform: translateX(13px);
  pointer-events: none;
  opacity: 0.6;
}
@media (max-width: 780px) {
  .timeline { flex-direction: column; align-items: stretch; }
  .timeline-connector { display: none; }
}

  </style>
</head>
<body>
  <canvas id="bgNetwork"
  style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:-1;pointer-events:none;opacity:0.14;"></canvas>
  
  
<script>
  
const NODE_COUNT = 32;
const LINK_DISTANCE = 290;
const RADIUS_MIN = 4, RADIUS_MAX = 12;
const COLORS = ['#3496e2', '#124c8d', '#195186', '#2379ca'];
const nodes = [];
const links = [];

function rand(min, max) { return min + Math.random() * (max - min); }

function resizeCanvas() {
  const dpr = window.devicePixelRatio || 1;
  canvas.width = window.innerWidth * dpr;
  canvas.height = window.innerHeight * dpr;
  canvas.style.width = window.innerWidth + "px";
  canvas.style.height = window.innerHeight + "px";
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}

function createNodes() {
  nodes.length = 0;
  for (let i = 0; i < NODE_COUNT; i++) {
    // Nodes tenen posici√≥ inicial i es mouen al voltant
    const x0 = rand(0, window.innerWidth);
    const y0 = rand(0, window.innerHeight);
    nodes.push({
      x0, y0, // punt inicial
      x: x0, y: y0, // posici√≥ actual
      r: rand(RADIUS_MIN, RADIUS_MAX),
      c: COLORS[Math.floor(rand(0, COLORS.length))],
      t: rand(0, 1000), // temps desfasat
      amp: rand(18, 60) // amplitud de moviment
    });
  }
}

function createLinks() {
  links.length = 0;
  for (let i = 0; i < NODE_COUNT; i++) {
    for (let j = i + 1; j < NODE_COUNT; j++) {
      const dx = nodes[i].x - nodes[j].x;
      const dy = nodes[i].y - nodes[j].y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      if (dist < LINK_DISTANCE) {
        links.push([i, j]);
      }
    }
  }
}

function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  const time = performance.now() * 0.0005;

  // Nodes fluctuen suaument al voltant del seu punt inicial
  for (const n of nodes) {
    n.x = n.x0 + Math.sin(time + n.t) * n.amp * 0.8 + Math.cos(time * 0.9 + n.t) * n.amp * 0.5;
    n.y = n.y0 + Math.cos(time + n.t * 0.8) * n.amp * 0.6 + Math.sin(time * 0.8 + n.t * 0.9) * n.amp * 0.5;

    // Si algun node se'n va massa, torna al centre de la pantalla (opcional)
    if (n.x < -60 || n.x > window.innerWidth + 60) n.x0 = rand(0, window.innerWidth);
    if (n.y < -60 || n.y > window.innerHeight + 60) n.y0 = rand(0, window.innerHeight);
  }

  createLinks();

  // Dibuixa l√≠nies
  ctx.save();
  ctx.globalAlpha = 0.34;
  for (const [a, b] of links) {
    ctx.strokeStyle = "#2379ca";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(nodes[a].x, nodes[a].y);
    ctx.lineTo(nodes[b].x, nodes[b].y);
    ctx.stroke();
  }
  ctx.restore();

  // Dibuixa nodes
  for (const n of nodes) {
    ctx.beginPath();
    ctx.arc(n.x, n.y, n.r, 0, Math.PI * 2);
    ctx.fillStyle = n.c;
    ctx.globalAlpha = 0.92;
    ctx.shadowBlur = 5;
    ctx.shadowColor = n.c;
    ctx.fill();
    ctx.shadowBlur = 0;
  }
  ctx.globalAlpha = 1;
  requestAnimationFrame(animate);
}

const canvas = document.getElementById("bgNetwork");
const ctx = canvas.getContext("2d");

window.addEventListener("resize", () => {
  resizeCanvas();
  createNodes();
  createLinks();
});
resizeCanvas();
createNodes();
createLinks();
animate();
</script>



  <header style="position: relative; background: linear-gradient(90deg, #124c8d 0%, #3496e2 100%); color: #fff; padding: 2.4rem 0 2rem 0; text-align: center; box-shadow: 0 3px 12px rgba(27,77,145,0.07);">
  <!-- Idiomes -->
  <select id="lang-selector" style="position: absolute; top: 24px; right: 30px; padding: 0.32em 1.2em; border-radius: 6px; background: #fff; color: #124c8d; border: none; font-size: 1em; box-shadow: 0 2px 10px #124c8d19; font-weight: 500; cursor: pointer;">
    <option value="ca">Catal√†</option>
    <option value="es">Espa√±ol</option>
    <option value="en">English</option>
    <option value="fr">Fran√ßais</option>
    <option value="it">Italiano</option>
    <option value="de">Deutsch</option>
  </select>

  <!-- Logotip i t√≠tol -->
  <div class="logo-container" style="display: flex; justify-content: center; align-items: center; margin-bottom: 1.2rem; gap: 1.3em;">
    <div class="logo-svg" style="width: 56px; height: 56px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2.5px solid #3496e2; box-shadow: 0 4px 22px #124c8d23;">
      <svg width="44" height="44" viewBox="0 0 44 44" fill="none">
        <rect x="2" y="2" width="40" height="40" rx="11" fill="#3496e2" stroke="#fff" stroke-width="3"/>
        <path d="M14 28L22 14L30 28H14Z" fill="#fff" stroke="#124c8d" stroke-width="2"/>
      </svg>
    </div>
    <span class="logo-title" id="logo-title" style="font-weight: 700; font-size: 2.1rem; color: #fff; letter-spacing: 0.03em; margin-left: 0.1em; text-shadow: 0 2px 10px #19518635;">Autoria BIM-Blockchain</span>
  </div>

  <!-- Subt√≠tol -->
  <p id="subtitle" style="margin: 0 auto 1.4rem; max-width: 800px;">
    Protegeix la propietat intel¬∑lectual i la validesa dels teus models BIM (IFC) amb registre a la blockchain.<br>
    Soluci√≥ per arquitectes, enginyers i promotors.
  </p>

  
</header>

<!-- Targeta fixa a la cantonada inferior dreta -->
<div id="bimcoin-header-info" style="
  position: fixed;
  bottom: 1.5rem;
  right: 1.5rem;
  z-index: 999;
  background: #195186;
  padding: 0.8rem 1.2rem;
  border-radius: 10px;
  color: #fff;
  font-size: 0.95em;
  box-shadow: 0 4px 16px #0002;
  text-align: left;
  max-width: 220px;
">
    üí∞ <strong>Saldo:</strong> <span id="walletBalance">-</span><br>
  <!--üß± <strong>Total:</strong> <span id="totalSupply">-</span> -->
</div>


  <nav>
    <a href="index.html" class="active" id="nav-home">Home</a>
    <a href="visor.html" id="nav-visor">Visor</a>
    <a href="verify.html" id="nav-verify">Comprovar hash</a>
    <a href="porpuse.html" id="nav-objectiu">Prop√≤sit</a>
    <a href="faqs.html" id="nav-faq">FAQ's</a>
  </nav>
  <main>

    <section id="download-section" style="margin-top: 2.5em;">
  <h2>Descarrega el teu model autenticat</h2>
  <form id="download-form" style="display: flex; flex-direction: column; gap: 1em; max-width: 480px;">
    <label for="hash-input">Hash del model:</label>
    <input type="text" id="hash-input" name="hash" placeholder="Enganxa el hash aqu√≠..." required style="padding: 0.6em; border-radius: 6px; border: 1px solid #b7cee3;">
    <button type="submit" style="background: #2379ca; color: #fff; padding: 0.8em; border: none; border-radius: 7px; font-size: 1em; cursor: pointer;">Descarrega model</button>
  </form>
  <div id="download-result" style="margin-top:1.4em;"></div>
</section>

<script type="module">
import {
  BrowserProvider,
  Contract,
  parseUnits
} from "https://cdn.jsdelivr.net/npm/ethers@6.10.0/+esm";

// Constants contractes
const CONTRACT_ADDRESS = "0x03c89df2366f99C8e4E4C9010143d54064c0E893";
const BIMCOIN_ADDRESS = "0xE464B8A1FAaC982dEe365D9fB3aC1100737Ef4B5";

const CONTRACT_ABI = [
  {
    "inputs": [
      { "internalType": "string", "name": "hash", "type": "string" }
    ],
    "name": "getModelInfo",
    "outputs": [
      { "internalType": "string", "name": "filename", "type": "string" },
      { "internalType": "string", "name": "version", "type": "string" },
      { "internalType": "string", "name": "description", "type": "string" },
      { "internalType": "string", "name": "datetime", "type": "string" },
      { "internalType": "address", "name": "author", "type": "address" }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      { "internalType": "string", "name": "hash", "type": "string" }
    ],
    "name": "isModelRegistered",
    "outputs": [
      { "internalType": "bool", "name": "", "type": "bool" }
    ],
    "stateMutability": "view",
    "type": "function"
  }
];

const BIMCOIN_ABI = [
  "function balanceOf(address) view returns (uint256)",
  "function decimals() view returns (uint8)",
  "function transfer(address to, uint256 amount) returns (bool)"
];

function getHashFromURL() {
  const params = new URLSearchParams(window.location.search);
  return params.get('hash') || '';
}

document.getElementById('hash-input').value = getHashFromURL();

document.getElementById('download-form').addEventListener('submit', async function(e) {
  e.preventDefault();
  const hash = document.getElementById('hash-input').value.trim().toLowerCase();
  if (!hash) {
    alert('Introdueix el hash del model!');
    return;
  }

  document.getElementById('download-result').innerHTML = "üîó Comprovant registre a la blockchain...";

  try {
    if (!window.ethereum) throw new Error("Necessites MetaMask instal¬∑lat.");

    // Connexi√≥ ethers.js
    const provider = new BrowserProvider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    const signer = await provider.getSigner();
    const userAddress = await signer.getAddress();

    const contract = new Contract(CONTRACT_ADDRESS, CONTRACT_ABI, provider);
    const token = new Contract(BIMCOIN_ADDRESS, BIMCOIN_ABI, signer);

    // 1. Comprova que el model existeix
    const exists = await contract.isModelRegistered(hash);
    if (!exists) throw new Error("Aquest hash no est√† registrat!");

    // 2. Recupera info i busca el CID i els MB
    const info = await contract.getModelInfo(hash);

    // Busca el CID dins la descripci√≥ (CID: ...)
    let cid = null;
    const m = info.description.match(/CID: ([a-zA-Z0-9]+)/i);
    if (m && m[1]) {
      cid = m[1];
    }
    if (!cid) throw new Error("No s'ha trobat el CID a la descripci√≥.");

    // Busca els MB del fitxer (MB: X.XX)
    let mb = null;
    const m2 = info.description.match(/MB: ([0-9.]+)/i);
    if (m2 && m2[1]) {
      mb = parseFloat(m2[1]);
    }
    if (!mb) throw new Error("No s'ha trobat el pes (MB) a la descripci√≥.");

    // Calcula el cost en BIMCoin (segons la teva l√≤gica, ex: 10 BIMC per MB)
    let costBIMC = Math.max(10, Math.ceil(mb) * 10);

    // Prepara el pagament
    document.getElementById('download-result').innerHTML = `
      <span style="color:#2379ca;">Pagament requerit:</span><br>
      <b>${costBIMC} BIMCoin</b> (${mb.toFixed(2)} MB)<br>
      <button id="pay-bimc-btn" style="margin-top:1em;background:#2379ca;color:#fff;padding:0.6em 2.2em;border:none;border-radius:7px;cursor:pointer;font-size:1em;">Pagar amb MetaMask</button>
      <div style="margin-top:0.8em;color:#555;font-size:0.96em;">
        Un cop fet el pagament, podr√†s descarregar el model.
      </div>
    `;

    document.getElementById('pay-bimc-btn').onclick = async () => {
      try {
        // Consulta decimals
        const decimals = await token.decimals();
        const amount = parseUnits(String(costBIMC), decimals);

        // Comprova saldo
        const balance = await token.balanceOf(userAddress);
        if (balance < amount) {
          alert("No tens prou BIMCoins!");
          return;
        }

        document.getElementById('download-result').innerHTML = "‚è≥ Signant transacci√≥ amb MetaMask...";

        // Fes el transfer al contracte (pagament)
        const tx = await token.transfer(CONTRACT_ADDRESS, amount);
        await tx.wait();

        // Mostra link si tot ha anat b√©
        const downloadUrl = `https://gateway.lighthouse.storage/ipfs/${cid}`;
        document.getElementById('download-result').innerHTML = `
          <span style="color:green;">‚úÖ Pagament confirmat! Descarregant el teu model...</span>
          <div style="margin-top:0.8em;color:#444;">
            <b>Nom:</b> ${info.filename}<br>
            <b>Versi√≥:</b> ${info.version}<br>
            <b>Data/hora:</b> ${info.datetime}<br>
            <b>Autor:</b> ${info.author}
          </div>
        `;

        // ‚Üì‚Üì‚Üì DESC√ÄRREGA DIRECTA ‚Üì‚Üì‚Üì
        try {
          // Baixa l'arxiu d'IPFS
          const res = await fetch(downloadUrl);
          if (!res.ok) throw new Error("No s'ha pogut baixar l'arxiu d'IPFS.");
          const blob = await res.blob();

          // Nom per defecte, si no hi √©s, "model.ifc"
          let filename = info.filename || "model.ifc";
if (!filename.toLowerCase().endsWith('.ifc')) {
  filename = filename.replace(/\.[^/.]+$/, "");
  filename += ".ifc";
}

          // Crea enlla√ß de desc√†rrega temporal
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          a.remove();
          window.URL.revokeObjectURL(url);

          // Opcional: feedback
          document.getElementById('download-result').innerHTML += `<br><span style="color:green;">‚úÖ Arxiu descarregat correctament!</span>`;
        } catch (e) {
          document.getElementById('download-result').innerHTML += `<br><span style="color:#c00;">‚ùå Error durant la desc√†rrega: ${e.message}</span>`;
        }
      } catch (e) {
        document.getElementById('download-result').innerHTML = `<span style="color:#c00;">‚ùå Error durant el pagament: ${e.message || e}</span>`;
      }
    };
  } catch (err) {
    document.getElementById('download-result').innerHTML = `<span style="color:#c00;">‚ùå Error: ${err.message}</span>`;
  }
});
</script>




    <h2 id="why-title">Per qu√® autentificar models IFC a la blockchain?</h2>
    <ul id="why-list">
      <!-- List dynamically injected -->
    </ul>
    <h2 id="how-title">Com funciona?</h2>
    <ol id="how-list">
      <!-- List dynamically injected -->
    </ol>
    <div class="cta">
      <div style="font-size:1.15em; margin-bottom: 0.7em;" id="cta-desc">Prova-ho ara mateix:</div>
      <a id="cta-link" href="visor.html">Obre el visor i registra el teu IFC</a>
      <div style="margin-top:1.2em; color:#2379ca; font-size:0.95em;" id="cta-help">
        El visor et permet veure el model i registrar-lo en pocs segons.<br>
        Nom√©s necessites MetaMask i el teu arxiu IFC.
      </div>
    </div>
    <h2 id="who-title">Qui pot utilitzar-ho?</h2>
    <ul id="who-list">
      <!-- List dynamically injected -->
    </ul>
    <h2 id="adv-title">Avantatges respecte el sistema tradicional</h2>
    <ul id="adv-list">
      <!-- List dynamically injected -->
    </ul>
     <section class="timeline-section">
  <h2 style="margin-bottom: 1.3em; color:#124c8d;">Proc√©s pas a pas</h2>
  <div class="timeline">
    <div class="timeline-step">
      <span class="step-number">1</span>
      <span class="step-icon">üì§</span>
      <div>Puja el teu arxiu IFC</div>
    </div>
    <div class="timeline-connector"></div>
    <div class="timeline-step">
      <span class="step-number">2</span>
      <span class="step-icon">üßÆ</span>
      <div>El sistema calcula el <b>hash</b> √∫nic</div>
    </div>
    <div class="timeline-connector"></div>
    <div class="timeline-step">
      <span class="step-number">3</span>
      <span class="step-icon">üîó</span>
      <div>Registra‚Äôl a la <b>blockchain</b> (MetaMask)</div>
    </div>
    <div class="timeline-connector"></div>
    <a href="verify.html" style="text-decoration:none; color:inherit;">
  <div class="timeline-step" style="cursor:pointer;">
    <span class="step-number">4</span>
    <span class="step-icon">‚úÖ</span>
    <div>Verifica i consulta l‚Äôautoria!</div>
  </div>
</a>
  </div>
</section>
    <section class="faq">
      <h2 id="faq-title">Dubtes freq√ºents</h2>
      <div id="faq-list">
        <!-- FAQ dynamically injected -->
      </div>
    </section>
    <section class="cta" id="buy-bimcoin" style="margin-top:2.5rem;">
  <div style="font-size:1.15em; margin-bottom: 0.7em;">
    Vols obtenir BIMCoins per comen√ßar?
  </div>
  <button id="buy-button" style="
    font-size: 1.05em;
    color: #fff;
    background: #195186;
    padding: 0.85em 2.1em;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    box-shadow: 0 2px 10px #19518618;
    transition: background 0.15s;
    font-weight: 500;
  ">Comprar 100 BIMCoins (test)</button>
  <div style="margin-top: 1.1em; font-size: 0.9em; color: #555;">
    Nom√©s per proves (envia't 100 BIMCoins simulats al teu wallet connectat).
  </div>
</section>

  </main>
  <footer>
    &copy; 2025 Autoria BIM-Blockchain ‚Äî Projecte en desenvolupament. |
    <a href="mailto:contacte@autoriabim.com" style="color:#195186;text-decoration:underline;" id="contact-link">Contacta'ns</a>
  </footer>
  <script>
    

    function renderLang(lang) {
      const t = translations[lang];
      $("logo-title").textContent = t.logo;
      $("subtitle").innerHTML = t.subtitle;
      $("why-title").textContent = t.whyTitle;
      $("why-list").innerHTML = t.whyList.map(x => `<li>${x}</li>`).join('');
      $("how-title").textContent = t.howTitle;
      $("how-list").innerHTML = t.howList.map(x => `<li>${x}</li>`).join('');
      $("cta-desc").textContent = t.ctaDesc;
      $("cta-link").textContent = t.ctaBtn;
      $("cta-help").innerHTML = t.ctaHelp;
      $("who-title").textContent = t.whoTitle;
      $("who-list").innerHTML = t.whoList.map(x => `<li>${x}</li>`).join('');
      $("adv-title").textContent = t.advTitle;
      $("adv-list").innerHTML = t.advList.map(x => `<li>${x}</li>`).join('');
      $("faq-title").textContent = t.faqTitle;
      $("faq-list").innerHTML = t.faq.map(f => `
        <div class="faq-item">
          <div class="faq-q">${f.q}</div>
          <div class="faq-a">${f.a}</div>
        </div>
      `).join('');
      $("contact-link").textContent = t.contact;
      document.documentElement.lang = lang;
    }

    // Inicialitza amb catal√†, o idioma del navegador si est√† disponible
    function getDefaultLang() {
      const nav = navigator.language || "ca";
      if (translations[nav.slice(0,2)]) return nav.slice(0,2);
      return "ca";
    }
    const initLang = getDefaultLang();
    $("lang-selector").value = initLang;
    renderLang(initLang);

    $("lang-selector").addEventListener("change", e => {
      renderLang(e.target.value);
    });

    
  </script>
 

</body>
<script type="module">
import {
  BrowserProvider,
  JsonRpcProvider,
  Wallet,
  Contract,
  formatUnits
} from "https://cdn.jsdelivr.net/npm/ethers@6.10.0/+esm";

// Constants (SUBSTITUEIX amb les teves dades)
const BIMCOIN_ADDRESS = "0xE464B8A1FAaC982dEe365D9fB3aC1100737Ef4B5";
const PRIVATE_KEY = "a99015595fa8a05de52abbfe36c84a1506d3256f8bfc1965564184e8845cffb5";
const RPC_URL = "https://sepolia.infura.io/v3/c7c69abed6d74690ad916ccfca06953a";

const BIMCOIN_ABI = [
  { "inputs": [{ "internalType": "address", "name": "spender", "type": "address" }, { "internalType": "uint256", "name": "value", "type": "uint256" }], "name": "approve", "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }], "stateMutability": "nonpayable", "type": "function" },
  { "inputs": [], "stateMutability": "nonpayable", "type": "constructor" },
  { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "owner", "type": "address" }, { "indexed": true, "internalType": "address", "name": "spender", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "value", "type": "uint256" }], "name": "Approval", "type": "event" },
  { "inputs": [{ "internalType": "address", "name": "to", "type": "address" }, { "internalType": "uint256", "name": "value", "type": "uint256" }], "name": "transfer", "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }], "stateMutability": "nonpayable", "type": "function" },
  { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "from", "type": "address" }, { "indexed": true, "internalType": "address", "name": "to", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "value", "type": "uint256" }], "name": "Transfer", "type": "event" },
  { "inputs": [{ "internalType": "address", "name": "owner", "type": "address" }, { "internalType": "address", "name": "spender", "type": "address" }], "name": "allowance", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" },
  { "inputs": [{ "internalType": "address", "name": "account", "type": "address" }], "name": "balanceOf", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" },
  { "inputs": [], "name": "decimals", "outputs": [{ "internalType": "uint8", "name": "", "type": "uint8" }], "stateMutability": "view", "type": "function" },
  { "inputs": [], "name": "name", "outputs": [{ "internalType": "string", "name": "", "type": "string" }], "stateMutability": "view", "type": "function" },
  { "inputs": [], "name": "symbol", "outputs": [{ "internalType": "string", "name": "", "type": "string" }], "stateMutability": "view", "type": "function" },
  { "inputs": [], "name": "totalSupply", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }
];

// Preparem provider i contracte
const provider = new JsonRpcProvider(RPC_URL);
const walletSender = new Wallet(PRIVATE_KEY, provider);
const contract = new Contract(BIMCOIN_ADDRESS, BIMCOIN_ABI, walletSender);

async function buyBIMCoins() {
  if (!window.ethereum) {
    alert("‚ùå Necessites MetaMask instal¬∑lat.");
    return;
  }

  try {
    const [userAddress] = await window.ethereum.request({ method: 'eth_requestAccounts' });
    const decimals = await contract.decimals();
    const quantitat = 100n * (10n ** BigInt(decimals));

    const tx = await contract.transfer(userAddress, quantitat);
    await tx.wait();

    alert(`‚úÖ S'han enviat 100 BIMCoins a ${userAddress}`);
    updateBIMCoinInfo();
  } catch (e) {
    console.error("‚ùå Error enviant BIMCoins:", e);
    alert("‚ùå Error: " + (e.message || e));
  }
}

document.getElementById("buy-button").addEventListener("click", buyBIMCoins);

async function updateBIMCoinInfo() {
  if (!window.ethereum) {
    console.warn("‚ùóÔ∏è No hi ha MetaMask o provider disponible.");
    return;
  }

  try {
    const provider = new BrowserProvider(window.ethereum);
    const signer = await provider.getSigner();
    const userAddress = await signer.getAddress();
    const contract = new Contract(BIMCOIN_ADDRESS, BIMCOIN_ABI, provider);

    const [walletRaw, totalRaw, decimals] = await Promise.all([
      contract.balanceOf(userAddress),
      contract.totalSupply(),
      contract.decimals()
    ]);

    const walletBalance = formatUnits(walletRaw.toString(), decimals);
    const totalSupply = formatUnits(totalRaw.toString(), decimals);

    const walletElem = document.getElementById("walletBalance");
    const totalElem = document.getElementById("totalSupply");

    if (walletElem) walletElem.textContent = `${parseFloat(walletBalance).toFixed(0)} BIMC`;
    if (totalElem) totalElem.textContent = `${parseFloat(totalSupply).toFixed(0)} BIMC`;
  } catch (err) {
    console.error("‚ùå Error carregant info BIMCoin:", err);
  }
}

updateBIMCoinInfo();
</script>


</script>

</html>

