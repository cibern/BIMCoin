import"./modulepreload-polyfill-B5Qt9EMX.js";import{u as w}from"./bimcoin-DS6TUAdR.js";import"https://cdn.jsdelivr.net/npm/ethers@6.10.0/+esm";function f(){document.getElementById("download-modal").style.display="flex",u()}function m(){document.getElementById("download-modal").style.display="none",u()}document.getElementById("convert-download-modal-btn").onclick=f;document.getElementById("close-download-modal").onclick=m;document.getElementById("cancel-download-modal").onclick=m;function u(){document.getElementById("levels-download-list").innerHTML="",document.getElementById("modal-download-actions").innerHTML="",document.getElementById("modal-download-result").textContent="",document.getElementById("ifc-download-upload").value="",document.getElementById("cancel-download-modal").style.display="none",window._lastIfcDownloadFile=null}document.getElementById("load-ifc-download-btn").onclick=()=>{document.getElementById("ifc-download-upload").click()};document.getElementById("ifc-download-upload").addEventListener("change",async e=>{const o=e.target.files[0];if(!o)return;document.getElementById("modal-download-result").textContent="Analitzant nivells...";const c=new FormData;c.append("file",o);let l=[],n="";try{const t=await(await fetch("http://localhost:8000/get_levels",{method:"POST",body:c})).json();if(l=t.levels||[],n=t.status||"",n.startsWith("error")){document.getElementById("modal-download-result").textContent="Error: "+n;return}}catch{document.getElementById("modal-download-result").textContent="Error llegint nivells de l'IFC.";return}document.getElementById("modal-download-result").textContent="Nivells trobats:";const a=document.getElementById("levels-download-list");a.innerHTML="",l.forEach((d,t)=>{const r=`level-download-check-${t}`,s=document.createElement("label");s.style.display="block",s.innerHTML=`<input type="checkbox" id="${r}" value="${d}" checked> ${d}`,a.appendChild(s)});const i=document.getElementById("modal-download-actions");i.innerHTML=`
    <button id="download-dxf3d-action-btn">Descarrega DXF 3D</button>
    <button id="download-dxf2d-action-btn">Descarrega DXF 2D</button>
    <button id="download-pdf-action-btn">Descarrega PDF</button>
  `,window._lastIfcDownloadFile=o,document.getElementById("cancel-download-modal").style.display="block"});document.addEventListener("click",async e=>{if(e.target&&e.target.id==="download-dxf3d-action-btn"){const o=window._lastIfcDownloadFile;if(!o)return;document.getElementById("modal-download-result").textContent="Convertint a DXF 3D...";const c=new FormData;c.append("file",o);const l=await fetch("http://localhost:8000/convert",{method:"POST",body:c});if(!l.ok){document.getElementById("modal-download-result").textContent="Error convertint IFC a OBJ!";return}const n=await l.blob(),a=new FormData;a.append("file",new File([n],"model.obj"));const i=await fetch("http://localhost:8000/obj2dxf",{method:"POST",body:a});if(!i.ok){document.getElementById("modal-download-result").textContent="Error convertint OBJ a DXF!";return}const d=await i.blob(),t=window.URL.createObjectURL(d),r=document.createElement("a");r.href=t,r.download="model_3d.dxf",r.click(),window.URL.revokeObjectURL(t),document.getElementById("modal-download-result").textContent="DXF 3D descarregat!"}});document.addEventListener("click",async e=>{if(e.target&&e.target.id==="download-dxf2d-action-btn"){const o=window._lastIfcDownloadFile;if(!o)return;const c=document.getElementById("levels-download-list"),l=Array.from(c.querySelectorAll("input[type=checkbox]:checked")).map(r=>r.value);if(!l.length){document.getElementById("modal-download-result").textContent="Selecciona almenys un nivell!";return}const n=new FormData;n.append("file",o),n.append("levels",JSON.stringify(l)),document.getElementById("modal-download-result").textContent="Convertint a DXF 2D...";const a=await fetch("http://localhost:8000/dxf2d",{method:"POST",body:n});if(!a.ok){document.getElementById("modal-download-result").textContent="Error convertint a DXF 2D!";return}const i=await a.blob(),d=window.URL.createObjectURL(i),t=document.createElement("a");t.href=d,t.download="nivells_planta.dxf",t.click(),window.URL.revokeObjectURL(d),document.getElementById("modal-download-result").textContent="DXF 2D descarregat!"}});document.addEventListener("click",async e=>{e.target&&e.target.id==="download-pdf-action-btn"&&(document.getElementById("modal-download-result").textContent="Funcionalitat PDF pendent!")});document.addEventListener("DOMContentLoaded",async()=>{w()});
