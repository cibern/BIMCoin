import"./modulepreload-polyfill-B5Qt9EMX.js";import{BrowserProvider as k,Contract as x,parseUnits as $}from"https://cdn.jsdelivr.net/npm/ethers@6.10.0/+esm";import{B as q,b as A,R as F,c as H,C as N}from"./blockchainConfig-nCfmhYd7.js";import{BrowserProvider as S,Contract as I,formatUnits as C}from"./index-BIZAE8L5.js";const R={ca:{logo:"Autoria BIM-Blockchain",subtitle:"Protegeix la propietat intel¬∑lectual i la validesa dels teus models BIM (IFC) amb registre a la blockchain.<br>Soluci√≥ per arquitectes, enginyers i promotors.",whyTitle:"Per qu√® registrar un arxiu IFC?",whyList:["üìê <b>L‚ÄôIFC √©s l‚Äôarxiu font de la realitat constru√Øda</b><br>Cont√© tota la informaci√≥ del projecte: geometria, materials, sistemes constructius, entitats, propietats i classificacions. √âs interoperable entre programes i est√†ndards (Revit, Archicad, Allplan...). Permet fer c√†lculs, medicions, pressupostos i fins i tot generar el projecte executiu o constructiu.",'üì¶ <b>√âs el "PDF intel¬∑ligent" del m√≥n de l‚Äôarquitectura</b><br>Com un PDF signat digitalment, l‚ÄôIFC pot ser considerat l‚Äôoriginal digital d‚Äôun projecte BIM. Una vegada generat, no caldria modificar-lo si s‚Äôha de consultar, verificar o construir.',"üîí <b>Un cop registrat, esdev√© inalterable i tra√ßable</b><br>El hash actua com una empremta digital √∫nica. Qualsevol canvi (per petit que sigui) genera un hash diferent, i per tant, permet detectar si s‚Äôha modificat. Permet fer seguiment de versions (v1, v2, etc.) mantenint l‚Äôautoria clara.","üßë‚Äç‚öñÔ∏è <b>Protecci√≥ legal de la propietat intel¬∑lectual</b><br>Registra l‚Äôautor i la data exacta de creaci√≥ o entrega. En cas de conflicte (copiatge, robatori de projecte), l‚Äôautor pot demostrar que ell el va generar primer. La blockchain actua com un registre p√∫blic, immutable i accessible globalment.","üìà <b>Credibilitat davant clients i col¬∑laboradors</b><br>El client pot veure que el model ha estat validat i registrat. √âs una forma de garantir que el que es lliura √©s fiable i professional. Millora la confian√ßa en equips multidisciplinaris (arquitectes, enginyers, constructores‚Ä¶).","‚ôªÔ∏è <b>Base per sistemes futurs de tra√ßabilitat i certificaci√≥</b><br>Amb el registre podem fer: historial de versions, certificaci√≥ energ√®tica i ambiental basada en dades reals, sistemes de pagament automatitzat per entregues, verificaci√≥ autom√†tica de revisions en concursos o licitacions."],howTitle:"Com funciona?",howList:["Puja el teu arxiu IFC al visor web.","El sistema calcula autom√†ticament el seu identificador √∫nic (hash).","Registra el model a la blockchain Ethereum (via MetaMask).","Consulta, verifica i valida models en qualsevol moment!"],ctaDesc:"Prova-ho ara mateix:",ctaBtn:"Obre el visor i registra el teu IFC",ctaHelp:"El visor et permet veure el model i registrar-lo en pocs segons.<br>Nom√©s necessites MetaMask i el teu arxiu IFC.",whoTitle:"Qui pot utilitzar-ho?",whoList:["Arquitectes, enginyers i despatxos professionals.","Promotors i gestors de projectes.","Clients que volen verificar l'autenticitat d'un projecte BIM.","Qualsevol persona que necessiti una prova d‚Äôautoria digital i tra√ßable."],advTitle:"Avantatges respecte el sistema tradicional",advList:["No dep√®n d'una entitat central: la blockchain √©s p√∫blica i transparent.","M√†xima seguretat: nom√©s l'autor pot registrar el seu model.","Consulta 24/7 i des de qualsevol lloc del m√≥n.","Pot ser base per sistemes de pagament, certificaci√≥ o tra√ßabilitat en el futur."],faqTitle:"Dubtes freq√ºents",faq:[{q:"√âs confidencial?",a:"El contingut del model no es publica, nom√©s l'identificador i metadades."},{q:"Qu√® passa si alg√∫ registra el meu model?",a:"Nom√©s el primer registre queda a la blockchain; pots demostrar-ho sempre amb el teu fitxer."},{q:"Puc registrar revisions?",a:"S√≠, cada canvi genera un hash diferent i pots registrar m√∫ltiples versions."},{q:"Funciona amb qualsevol IFC?",a:"S√≠, sempre que sigui un arxiu est√†ndard IFC2x3 o IFC4."},{q:"Necessito tenir criptomonedes?",a:"Nom√©s cal MetaMask. Les transaccions es poden fer en la xarxa de proves per no gastar diners reals."},{q:"Com puc validar un model rebut?",a:"Utilitza la funci√≥ de consulta per enganxar el hash i veure si ja est√† registrat a la blockchain."}],contact:"Contacta'ns"}},L="0x03c89df2366f99C8e4E4C9010143d54064c0E893",P="0xE464B8A1FAaC982dEe365D9fB3aC1100737Ef4B5",O=[{inputs:[{internalType:"string",name:"hash",type:"string"}],name:"getModelInfo",outputs:[{internalType:"string",name:"filename",type:"string"},{internalType:"string",name:"version",type:"string"},{internalType:"string",name:"description",type:"string"},{internalType:"string",name:"datetime",type:"string"},{internalType:"address",name:"author",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"string",name:"hash",type:"string"}],name:"isModelRegistered",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"}],j=["function balanceOf(address) view returns (uint256)","function decimals() view returns (uint8)","function transfer(address to, uint256 amount) returns (bool)"];function U(){return new URLSearchParams(window.location.search).get("hash")||""}document.getElementById("hash-input").value=U();document.getElementById("download-form").addEventListener("submit",async function(a){a.preventDefault();const t=document.getElementById("hash-input").value.trim().toLowerCase();if(!t){alert("Introdueix el hash del model!");return}document.getElementById("download-result").innerHTML="üîó Comprovant registre a la blockchain...";try{if(!window.ethereum)throw new Error("Necessites MetaMask instal¬∑lat.");const n=new k(window.ethereum);await n.send("eth_requestAccounts",[]);const d=await n.getSigner(),h=await d.getAddress(),u=new x(L,O,n),s=new x(P,j,d);if(!await u.isModelRegistered(t))throw new Error("Aquest hash no est√† registrat!");const i=await u.getModelInfo(t);let l=null;const c=i.description.match(/CID: ([a-zA-Z0-9]+)/i);if(c&&c[1]&&(l=c[1]),!l)throw new Error("No s'ha trobat el CID a la descripci√≥.");let p=null;const m=i.description.match(/MB: ([0-9.]+)/i);if(m&&m[1]&&(p=parseFloat(m[1])),!p)throw new Error("No s'ha trobat el pes (MB) a la descripci√≥.");let v=Math.max(10,Math.ceil(p)*10);document.getElementById("download-result").innerHTML=`
      <span style="color:#2379ca;">Pagament requerit:</span><br>
      <b>${v} BIMCoin</b> (${p.toFixed(2)} MB)<br>
      <button id="pay-bimc-btn" style="margin-top:1em;background:#2379ca;color:#fff;padding:0.6em 2.2em;border:none;border-radius:7px;cursor:pointer;font-size:1em;">Pagar amb MetaMask</button>
      <div style="margin-top:0.8em;color:#555;font-size:0.96em;">
        Un cop fet el pagament, podr√†s descarregar el model.
      </div>
    `,document.getElementById("pay-bimc-btn").onclick=async()=>{try{const r=await s.decimals(),y=$(String(v),r);if(await s.balanceOf(h)<y){alert("No tens prou BIMCoins!");return}document.getElementById("download-result").innerHTML="‚è≥ Signant transacci√≥ amb MetaMask...",await(await s.transfer(L,y)).wait();const g=`https://gateway.lighthouse.storage/ipfs/${l}`;document.getElementById("download-result").innerHTML=`
          <span style="color:green;">‚úÖ Pagament confirmat! Descarregant el teu model...</span>
          
          <div style="margin-top:0.8em;color:#444;">
            <b>Nom:</b> ${i.filename}<br>
            <b>Versi√≥:</b> ${i.version}<br>
            <b>Data/hora:</b> ${i.datetime}<br>
            <b>Autor:</b> ${i.author}
          </div>
        `;try{const f=await fetch(g);if(!f.ok)throw new Error("No s'ha pogut baixar l'arxiu d'IPFS.");const D=await f.blob();let w=i.filename||"model.ifc";w.toLowerCase().endsWith(".ifc")||(w=w.replace(/\.[^/.]+$/,""),w+=".ifc");const B=window.URL.createObjectURL(D),b=document.createElement("a");b.href=B,b.download=w,document.body.appendChild(b),b.click(),b.remove(),window.URL.revokeObjectURL(B),document.getElementById("download-result").innerHTML+='<br><span style="color:green;">‚úÖ Arxiu descarregat correctament!</span>'}catch(f){document.getElementById("download-result").innerHTML+=`<br><span style="color:#c00;">‚ùå Error durant la desc√†rrega: ${f.message}</span>`}}catch(r){document.getElementById("download-result").innerHTML=`<span style="color:#c00;">‚ùå Error durant el pagament: ${r.message||r}</span>`}}}catch(n){document.getElementById("download-result").innerHTML=`<span style="color:#c00;">‚ùå Error: ${n.message}</span>`}});const e=a=>document.getElementById(a);function T(a){const t=R[a];t&&(e("logo-title").textContent=t.logo,e("subtitle").innerHTML=t.subtitle,e("why-title")&&(e("why-title").textContent=t.whyTitle),e("why-list")&&(e("why-list").innerHTML=t.whyList.map(n=>`<li>${n}</li>`).join("")),e("how-title")&&(e("how-title").textContent=t.howTitle),e("how-list")&&(e("how-list").innerHTML=t.howList.map(n=>`<li>${n}</li>`).join("")),e("cta-desc")&&(e("cta-desc").textContent=t.ctaDesc),e("cta-link")&&(e("cta-link").textContent=t.ctaBtn),e("cta-help")&&(e("cta-help").innerHTML=t.ctaHelp),e("who-title")&&(e("who-title").textContent=t.whoTitle),e("who-list")&&(e("who-list").innerHTML=t.whoList.map(n=>`<li>${n}</li>`).join("")),e("adv-title")&&(e("adv-title").textContent=t.advTitle),e("adv-list")&&(e("adv-list").innerHTML=t.advList.map(n=>`<li>${n}</li>`).join("")),e("faq-title")&&(e("faq-title").textContent=t.faqTitle),e("faq-list")&&(e("faq-list").innerHTML=t.faq.map(n=>`
    <div class="faq-item">
      <div class="faq-q">${n.q}</div>
      <div class="faq-a">${n.a}</div>
    </div>
  `).join("")),e("contact-link")&&(e("contact-link").textContent=t.contact),document.documentElement.lang=a)}function _(){const a=navigator.language||"ca";return R[a.slice(0,2)]?a.slice(0,2):"ca"}document.addEventListener("DOMContentLoaded",()=>{const a=_();e("lang-selector").value=a,T(a),e("lang-selector").addEventListener("change",t=>{T(t.target.value)})});async function z(){if(!window.ethereum){console.warn("‚ùóÔ∏è No hi ha MetaMask o provider disponible.");return}try{const a=new S(window.ethereum),n=await(await a.getSigner()).getAddress(),d=new I(q,A,a),[h,u,s]=await Promise.all([d.balanceOf(n),d.totalSupply(),d.decimals()]),o=C(h.toString(),s),i=C(u.toString(),s),l=document.getElementById("walletBalance"),c=document.getElementById("totalSupply");l?l.textContent=`${parseFloat(o).toFixed(0)} BIMC`:console.warn("‚ö†Ô∏è No s'ha trobat #walletBalance al DOM"),c&&(c.textContent=`${parseFloat(i).toFixed(2)} BIMC`)}catch(a){console.error("‚ùå Error carregant info BIMCoin:",a)}}z();async function Q(){try{if(!window.ethereum)throw new Error("MetaMask no detectat");const a=new S(window.ethereum),t=new I(q,A,a),n=new I(V,G,a),h=(await n.queryFilter(n.filters.ModelRegistered())).length,u=await t.decimals(),s=t.filters.Transfer(),o=await t.queryFilter(s),i=o.length;let l=o.reduce((g,f)=>g+f.args.value,0n),c=C(l,u),p=Math.floor(Number(c)),m=o.length?o[o.length-1]:null,v=m?`Hash: <a href="https://sepolia.etherscan.io/tx/${m.transactionHash}" target="_blank" style="color:#2379ca;">${m.transactionHash.slice(0,10)}...</a>`:"‚Äî";const r=new Set;o.forEach(g=>{r.add(g.args.to.toLowerCase()),r.add(g.args.from.toLowerCase())}),r.delete("0x0000000000000000000000000000000000000000");const y=r.size,M=await t.balanceOf(N),E=Math.floor(Number(C(M,u)));document.getElementById("tx-count").textContent=i,document.getElementById("tx-volume").textContent=p+" BIMC",document.getElementById("last-tx").innerHTML=v,document.getElementById("tx-holders").innerHTML=y,document.getElementById("contract-balance").textContent=E+" BIMC",document.getElementById("num-models").textContent=h}catch{document.getElementById("tx-count").textContent="-",document.getElementById("tx-volume").textContent="-",document.getElementById("last-tx").textContent="-"}}const V=F,G=H;Q();
